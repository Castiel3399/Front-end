<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>slideshow</title>
</head>
<style>
.container{
  width:500px;
  height:300px;
  overflow:hidden;
  white-space: nowrap;
  position: relative;
}  
.carousel{
    width:500px;
    height:300px;
    overflow:hidden;
    white-space: nowrap;
}
.carousel>img{
    width:100%;
    height:100%;
    display:inline-block;
    transition:ease 0.5s;
}
.pointer{
  height: 30px;
  position: absolute;
  left: 50%;
  bottom: 0;
  background: transparent;
}
.pointer>span{
  display: inline-block;
  width: 15px;
  height: 15px;
  background: transparent;
  border: 1px solid #fff;
  border-radius: 50%;
  margin-right: 5px;
}
.active{
  background: #fff!important;
}
</style>
<body>
    <div class="container">
        <div id="carousel"></div>
        <div id="pointer" class="pointer">
    </div>

    <script>
        /* let container = document.getElementById('container');
        container.classList.add("carousel");
        let data = [
        "https://static001.geekbang.org/resource/image/bb/21/bb38fb7c1073eaee1755f81131f11d21.jpg",
        "https://static001.geekbang.org/resource/image/1b/21/1b809d9a2bdf3ecc481322d7c9223c21.jpg",
        "https://static001.geekbang.org/resource/image/b6/4f/b6d65b2f12646a9fd6b8cb2b020d754f.jpg",
        "https://static001.geekbang.org/resource/image/74/e4/730ea9c393def7975deceb48b3eb6fe4.jpg"
        ];
        //quota指配额,messages指信息数组
        function appendImgBox(quota,messages){
            for(let i = 0;i < quota;i++) {
                let imgBox = setImgBox(messages[i].title,messages[i].title,messages[i].url,messages[i].imgStyle);
                container.appendChild(imgBox);
            }
        }
        function setImgBox(title,style,url,imgStyle) {
            let createDiv = document.createElement('div');
            createDiv.title = title;
            createDiv.style = style;
            let createImg = document.createElement('img');
            img.src = url;
            img.style = imgStyle;
            return createDiv;
        }

        appendImgBox(3,data); */

        let data =  [
          {
            title: "包子脸",
            url: "https://static001.geekbang.org/resource/image/bb/21/bb38fb7c1073eaee1755f81131f11d21.jpg"
          },
          {
            title: "舔手",
            url: "https://static001.geekbang.org/resource/image/1b/21/1b809d9a2bdf3ecc481322d7c9223c21.jpg"
          },
          {
            title: "梨花",
            url: "https://static001.geekbang.org/resource/image/b6/4f/b6d65b2f12646a9fd6b8cb2b020d754f.jpg"
          },
          {
            title: "慵懒",
            url: "https://static001.geekbang.org/resource/image/73/e4/730ea9c393def7975deceb48b3eb6fe4.jpg"
          }
        ];

        class Carousel {
            constructor(container , pointer){
                this._container = container;
                this._container.classList.add('carousel');
                this._pointer = pointer;
                this.data = null;
            }

            render() {
               for(let item of this.data){
                   let e = document.createElement('img');
                   e.src = item.url;
                   this._container.appendChild(e);
                   let span = document.createElement('span');
                   this._pointer.appendChild(span);
               } 

               let children = this._container.children;
               let points = this._pointer.children;
               let position = 0;
               this._pointer.style.marginLeft = `-${this._pointer.clientWidth / 2}px`;
               points[0].classList.add('active');

               let nextFrame = () => {
                   let nextPosition = position + 1;
                   nextPosition = nextPosition % children.length;

                   let current = children[position];
                   let next = children[nextPosition];
                   points[position].classList.remove('active');

                   next.style.transition = "ease 0s";
                   next.style.transform = `translate(${100 - nextPosition * 100}%)`;
                   requestAnimationFrame(() => {
                     requestAnimationFrame(() => {
                      current.style.transition = '';
                      current.style.transform = `translate(${-100 - position * 100}%)`;
                      next.style.transition = "";
                      next.style.transform = `translate(${- nextPosition * 100}%)`;
                      position = nextPosition;
                      points[position].classList.add('active');
                     })
                   })
                   setTimeout(nextFrame,3000);
               }
               setTimeout(nextFrame,3000);

               let startX;
               let startTransform;
               let endX;
               let start = event => {
                 event.preventDefault();
                 startX = event.clientX;
                 startTransform = - position * 500;
                 this._container.addEventListener("mousemove",move);
                 this._container.addEventListener("mouseup", end);
               }

               let move = event => {
                 event.preventDefault();
                 endX = event.clientX;
                 let minX = - 500 * (children.length - 1);
                 if(startTransform + endX - startX > 0 || startTransform + endX - startX < minX){
                  startX = event.clientX;
                   return;
                 }
                 for(let child of children){
                   child.style.transition = "ease 0s";
                   child.style.transform = `translate(${ startTransform + endX - startX }px)`;
                 }
               }

               let end = () => {
                 points[position].classList.remove("active");
                 this._container.removeEventListener("mousemove",move);
                 this._container.removeEventListener("mouseup",end);
                 position = Math.round(- (startTransform + endX - startX) / 500);
                 position = Math.max(0,Math.min(position,children.length - 1));
                 points[position].classList.add("active");
                 for(let child of children){
                   child.style.transition = "";
                   child.style.transform = `translate(${-position * 100}%)`;
                 }
               }
               this._container.addEventListener('mousedown',start);
            }
        }

        let carousel = new Carousel(document.getElementById('carousel'),document.getElementById('pointer'));
        carousel.data = data;
        carousel.render();

        


    </script>
</body>
</html>