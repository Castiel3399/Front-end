<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <div id="main" style="width: 300px;height: 300px;background: chartreuse;"></div>
    <script>

        let main = document.getElementById('main');
        let contexts = Object.create(null);
        
        let start = (point,context) => {
            // console.log('start',point.clientX,point.clientY);

            context.startX = point.clientX;
            context.startY = point.clientY;
            context.isTap = true;
            context.isPan = false;
        }
        let move = (point,context) => {
            // console.log('move',point.clientX,point.clientY);
            let dX = point.clientX - context.startX , dY = point.clientY - context.startY;
            if((dX * dX + dY * dY) > 100){
                context.isTap = false;
                if(!context.isPan){
                    let e = new Event('panstart');
                    e.startX = context.startX;
                    e.startY = context.startY;
                    main.dispatchEvent(e);
                    context.isPan = true;
                }
            }
            if(context.isPan){
                let e = new Event('panmove');
                e.dX = dX;
                e.dY = dY;
                main.dispatchEvent(e);
            }
        }
        let end = (point,context) => {
            // console.log('end',point.clientX,point.clientY);
            if(context.isTap){
               let e = new Event('tap');
               main.dispatchEvent(e);
            }
              
            if(context.isPan){
              let e = new Event('panend');
              let dX = point.clientX - context.startX , dY = point.clientY - context.startY;
              e.dX = dX;
              e.dY = dY;
              main.dispatchEvent(e);
            }
              
        }

        let mouseSymbol  = Symbol('mouse'); 
        let mouseDown = event => {
            main.addEventListener('mousemove',mouseMove);
            main.addEventListener('mouseup',mouseUp);
            contexts[mouseSymbol] = Object.create(null);
            start(event, contexts[mouseSymbol]);
        }
        let mouseMove = event => {
            move(event, contexts[mouseSymbol]);
        }
        let mouseUp = event => {
            main.removeEventListener('mousemove',mouseMove);
            main.removeEventListener('mouseup',mouseUp);
            end(event, contexts[mouseSymbol]);
        }
        main.addEventListener('mousedown',mouseDown);

        let touchStart = event => {
            for(let point of event.changedTouches){
                contexts[point.identifier] = Object.create(null);
                start(point,contexts[point.identifier]);
            }
        }
        let touchMove = event => {
            for(let point of event.changedTouches){
                move(point,contexts[point.identifier]);
            }
        }
        let touchEnd = event => {
            for(let point of event.changedTouches){
                end(point,contexts[point.identifier]);
                console.log(point.identifier);
                delete contexts[point.identifier];
                console.log(contexts[point.identifier]);
            }
        }
        let touchCancle = event => {

        }
        main.addEventListener('touchstart',touchStart);
        main.addEventListener('touchmove',touchMove);
        main.addEventListener('touchend',touchEnd);
        main.addEventListener('touchcancle',touchCancle);
        main.addEventListener('panstart', e => {
            console.log('panstart',e);
        });
        main.addEventListener('panmove', e => {
            console.log(e);
            main.style.transform = `translate(${e.dX}px,${e.dY}px)`;
        });
        document.addEventListener('panend', e => {
            
        })
        main.addEventListener('tap', e => {
            console.log('tap',e);
        })

    </script>
</body>
</html>